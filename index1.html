<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
<form onsubmit="saveToLocal(event)" >
  <label for="name">Name</label>
  <input type="text" id="name" name="name">
  <label for="email">Email</label>
  <input type="text" id ="email"name="email">
  <label for="phone">Phone NO</label>
  <input type="text" id="phone" name="phone">
  <button >submit </button>
</form>

<ul id="listItems"></ul>



 
 <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
 <script >
   function saveToLocal(event){
    event.preventDefault();
    const name = event.target.name.value;
    const email = event.target.email.value;
    const phone = event.target.phone.value;

   const obj = {
    name,
    email,
    phone
   }

    //localStorage.setItem(obj.email,JSON.stringify(obj));
    axios.post("https://crudcrud.com/api/572d953087084b01b920f9580d326b0d/appData" ,{obj})
    .then(res =>{
        showItems(obj);
        console.log(res);
    })
    .catch(e => console.log(e))
    


   }

    


   function showItems(user){

    
    
    document.getElementById("name").value = "";
    document.getElementById("email").value = "";
    document.getElementById("phone").value = "";
    const parentElement = document.getElementById("listItems");
    const chidElemetn = document.createElement("li");
    if(user.name === undefined){
        chidElemetn.textContent = `${user.obj.name}-${user.obj.email}-${user.obj.phone}`;
    }else{
        chidElemetn.textContent = `${user.name}-${user.email}-${user.phone}`;
    }
    
    

   const deleteButton = document.createElement("input");
   deleteButton.type = "button";
   deleteButton.value = "delete";
   deleteButton.onclick = ()=>{
    const delId = user._id;
    axios.delete(`https://crudcrud.com/api/572d953087084b01b920f9580d326b0d/appData/${delId}`).then(res=>{
        for(let i=0; i< res.data.length ;i++){
            showItems(res.data[i]);
           }
        console.log(res.data);

    })
    //localStorage.removeItem(user.email);
    parentElement.removeChild(chidElemetn)
   }
   const editButton = document.createElement("input");
   editButton.type = "button";
   editButton.value = "edit";
   editButton.onclick = ()=>{
    const delId = user._id;
    axios.delete(`https://crudcrud.com/api/572d953087084b01b920f9580d326b0d/appData/${delId}`).then(res=>{
        // for(let i=0; i< res.data.length ;i++){
        //     showItems(res.data[i]);
        //    }
        console.log(res.data);
    })
    //localStorage.removeItem(user.email);

    parentElement.removeChild(chidElemetn);
    if(user.name === undefined){
        document.getElementById("name").value = user.obj.name;
        document.getElementById("email").value = user.obj.email;
         document.getElementById("phone").value = user.obj.phone;
    }else{
        document.getElementById("name").value = user.name;
        document.getElementById("email").value = user.email;
         document.getElementById("phone").value = user.phone;
    }
    
   }
    
    chidElemetn.appendChild(deleteButton);
    chidElemetn.appendChild(editButton);
    parentElement.appendChild(chidElemetn);
   }
   document.addEventListener("DOMContentLoaded",()=>{
        axios.get("https://crudcrud.com/api/572d953087084b01b920f9580d326b0d/appData").then(res =>{
           for(let i=0; i< res.data.length ;i++){
            showItems(res.data[i]);
           }
           console.log(res.data)
        })
        .catch(e=>console.log(e))
    })
 </script> 
</body>
</html>